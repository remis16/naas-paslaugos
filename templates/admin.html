<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Administravimo skydelis - Naas City Services. Tvarkykite paslaugas ir pridėkite naujas.">
    <meta name="keywords" content="admin, valdymas, paslaugos, Naas City, Naas, Airija, administravimas">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Naas City Services">
    <title>{{ translations.get('admin_title', 'Administravimas') }}</title>

    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}">
</head>

<body class="fade-in">

<!-- Popup notification -->
{% if popup_message %}
<div id="popup" class="popup {{ popup_type }}">
    {{ popup_message }}
</div>
{% endif %}

<main class="content">
    <h1>🛠️ {{ translations.get('admin_panel', 'Administravimo skydelis') }}</h1>

    <!-- Pridėti naują paslaugą -->
    <form method="POST" enctype="multipart/form-data" class="form" novalidate>
        {% for field in [
            {'label': 'Kategorija', 'name': 'kategorija', 'type': 'text', 'required': true, 'minlength': 2, 'maxlength': 50},
            {'label': 'Subkategorija', 'name': 'subkategorija', 'type': 'text', 'required': true, 'minlength': 2, 'maxlength': 50},
            {'label': 'Pavadinimas', 'name': 'pavadinimas', 'type': 'text', 'required': true, 'minlength': 2, 'maxlength': 100},
            {'label': 'Aprašymas', 'name': 'aprasymas', 'type': 'textarea', 'required': true, 'minlength': 10, 'maxlength': 1000},
            {'label': 'Adresas', 'name': 'adresas', 'type': 'text', 'required': true, 'minlength': 5, 'maxlength': 150},
            {'label': 'Telefonas', 'name': 'telefonas', 'type': 'tel', 'required': true, 'pattern': '\\+?\\d{7,15}', 'title': 'Įveskite telefono numerį'},
            {'label': 'Darbo laikas', 'name': 'darbo_laikas', 'type': 'text', 'required': true, 'minlength': 2, 'maxlength': 100},
            {'label': 'Google Maps nuoroda', 'name': 'maps', 'type': 'url', 'required': true, 'pattern': 'https?://.+', 'title': 'Turi prasidėti https://'},
            {'label': 'Svetainė (neprivaloma)', 'name': 'svetaine', 'type': 'url', 'pattern': 'https?://.+'},
            {'label': 'Nuotrauka (neprivaloma)', 'name': 'nuotrauka', 'type': 'file'}
        ] %}
        <div class="form-group">
            <label for="{{ field.name }}">{{ field.label }}:</label>
            {% if field.type == 'textarea' %}
                <textarea id="{{ field.name }}" name="{{ field.name }}" minlength="{{ field.minlength }}" maxlength="{{ field.maxlength }}" {% if field.required %}required{% endif %}></textarea>
            {% else %}
                <input type="{{ field.type }}" id="{{ field.name }}" name="{{ field.name }}" minlength="{{ field.minlength }}" maxlength="{{ field.maxlength }}" {% if field.pattern %}pattern="{{ field.pattern }}"{% endif %} {% if field.required %}required{% endif %}>
            {% endif %}
        </div>
        {% endfor %}
        <button type="submit" class="btn-save">➕ Pridėti paslaugą</button>
    </form>

    <hr>

    <!-- Esamos paslaugos -->
    <h2>📋 Esamos paslaugos:</h2>
    {% for kategorija, subkategorijos in duomenys.items() %}
    <section>
        <h3>{{ kategorija.replace('_', ' ').title() }}</h3>
        {% for subkategorija, paslaugos in subkategorijos.items() %}
        <h4>{{ subkategorija.replace('_', ' ').title() }}</h4>
        <ul>
            {% for paslauga in paslaugos %}
            <li class="paslauga-item">
                <strong>{{ paslauga.pavadinimas }}</strong> – {{ paslauga.adresas }}
                <form action="{{ url_for('redaguoti_paslauga') }}" method="GET" style="display:inline;">
                    <input type="hidden" name="kategorija" value="{{ kategorija }}">
                    <input type="hidden" name="subkategorija" value="{{ subkategorija }}">
                    <input type="hidden" name="index" value="{{ loop.index0 }}">
                    <button type="submit" title="Redaguoti">✏️</button>
                </form>
                <form action="{{ url_for('istrinti_paslauga') }}" method="POST" style="display:inline;">
                    <input type="hidden" name="kategorija" value="{{ kategorija }}">
                    <input type="hidden" name="subkategorija" value="{{ subkategorija }}">
                    <input type="hidden" name="index" value="{{ loop.index0 }}">
                    <button type="submit" onclick="return confirm('Ar tikrai norite ištrinti?')" title="Ištrinti">❌</button>
                </form>
            </li>
            {% endfor %}
        </ul>
        {% endfor %}
    </section>
    {% endfor %}

    <div style="margin-top:30px;">
        <a href="{{ url_for('index') }}" class="btn-back">⬅️ Grįžti į pradžią</a>
    </div>
</main>

<!-- Footer -->
<footer class="footer">
    <div class="footer-inner">
        <p>&copy; {{ year }} Naas City Services. {{ translations.get('rights_reserved', 'Visos teisės saugomos.') }}</p>
        <p style="font-size:0.9rem;">Server: {{ server_info }}</p>
    </div>
</footer>

<!-- JS -->
<script src="{{ url_for('static', filename='admin.js') }}"></script>

</body>
</html>